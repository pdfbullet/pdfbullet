import{u as ee,r as a,j as e,Y as te,S as se,ap as ae,aq as re,h as le,y as $,ar as oe,as as ne,at as de,au as ie}from"./main-Dmhdg2JE.js";import"./react-Ckhrjn13.js";const ce=(d,u=2)=>{if(!d||d===0)return"0 Bytes";const h=1024,y=u<0?0:u,f=["Bytes","KB","MB","GB","TB"],p=Math.floor(Math.log(d)/Math.log(h));return parseFloat((d/Math.pow(h,p)).toFixed(y))+" "+f[p]},xe=()=>{const[d,u]=a.useState(""),[h,y]=a.useState(""),[f,p]=a.useState(""),[v,S]=a.useState(null),[j,c]=a.useState(""),[x,g]=a.useState(!1),C=l=>{l.target.files&&l.target.files.length>0?S(l.target.files[0]):S(null)},N=async()=>{if(!d.trim()||!h.trim()){c("Title and message are required."),setTimeout(()=>c(""),3e3);return}g(!0),c("Sending...");try{let l="";v&&(c("Uploading file..."),l=await(await ne.ref(`notifications/${Date.now()}_${v.name}`).put(v)).ref.getDownloadURL()),c("Sending notification data..."),await de.collection("pwa_notifications").add({title:d.trim(),message:h.trim(),url:f.trim(),attachmentUrl:l,timestamp:ie.firestore.FieldValue.serverTimestamp()}),c("Notification sent successfully!"),u(""),y(""),p(""),S(null);const T=document.getElementById("notif-file");T&&(T.value="")}catch(l){c("Failed to send notification. Check console for details."),console.error(l)}finally{g(!1),setTimeout(()=>c(""),5e3)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-800",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Send PWA Push Notification"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"This will be sent to all PWA users. An active backend (like a Firebase Function) is needed to listen for this Firestore write and trigger a push service like OneSignal."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notif-title",className:"block text-sm font-semibold mb-1",children:"Title*"}),e.jsx("input",{id:"notif-title",type:"text",value:d,onChange:l=>u(l.target.value),className:"w-full p-2 border rounded-md",placeholder:"New Feature Alert!"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notif-message",className:"block text-sm font-semibold mb-1",children:"Message*"}),e.jsx("textarea",{id:"notif-message",rows:3,value:h,onChange:l=>y(l.target.value),className:"w-full p-2 border rounded-md",placeholder:"Check out our new AI-powered image generator..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notif-url",className:"block text-sm font-semibold mb-1",children:"Target URL (Optional)"}),e.jsx("input",{id:"notif-url",type:"text",value:f,onChange:l=>p(l.target.value),className:"w-full p-2 border rounded-md",placeholder:"/image-generator"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notif-file",className:"block text-sm font-semibold mb-1",children:"File Attachment (Optional)"}),e.jsx("input",{id:"notif-file",type:"file",onChange:C,className:"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-brand-red/10 file:text-brand-red hover:file:bg-brand-red/20"})]}),e.jsxs("button",{onClick:N,disabled:x,className:"flex items-center gap-2 bg-brand-red text-white font-bold py-2 px-6 rounded-md hover:bg-brand-red-dark disabled:bg-red-300",children:[e.jsx(oe,{className:"h-5 w-5"}),x?"Sending...":"Send Notification"]}),j&&e.jsx("p",{className:`text-sm mt-2 ${j.includes("Failed")?"text-red-500":"text-green-600"}`,children:j})]})]})},pe=()=>{const{getAllUsers:d,updateUserPremiumStatus:u,updateUserApiPlan:h,logout:y,deleteUser:f,getProblemReports:p,updateReportStatus:v,deleteProblemReport:S,getTaskHistory:j,deleteTaskRecord:c}=ee(),[x,g]=a.useState([]),[C,N]=a.useState(!0),[l,T]=a.useState(""),[i,w]=a.useState(""),[b,n]=a.useState(null),[F,A]=a.useState([]),[M,P]=a.useState(!0),[I,_]=a.useState(""),[D,U]=a.useState([]),[B,R]=a.useState(!0),[E,q]=a.useState(""),[o,L]=a.useState("users"),V=async()=>{N(!0),P(!0),R(!0);try{const[t,r,s]=await Promise.all([d(),p(),j()]);g(t),A(r),U(s)}catch{T("Failed to load dashboard data.")}finally{N(!1),P(!1),R(!1)}};a.useEffect(()=>{V()},[]);const G=()=>{o==="users"?(N(!0),d().then(g).catch(()=>T("Failed to load users.")).finally(()=>N(!1))):o==="reports"?(P(!0),p().then(A).catch(()=>_("Failed to load reports.")).finally(()=>P(!1))):o==="tasks"&&(R(!0),j().then(U).catch(()=>q("Failed to load tasks.")).finally(()=>R(!1)))},J=async(t,r)=>{n(t);try{await u(t,!r),g(x.map(s=>s.uid===t?{...s,isPremium:!r}:s))}catch{alert(`Failed to update status for user ${t}.`)}finally{n(null)}},K=async(t,r)=>{n(t);try{await h(t,r),g(x.map(s=>s.uid===t?{...s,apiPlan:r}:s))}catch{alert(`Failed to update API plan for user ${t}.`)}finally{n(null)}},Y=async(t,r)=>{n(t);try{await v(t,r),A(s=>s.map(m=>m.id===t?{...m,status:r}:m))}catch{alert("Failed to update report status.")}finally{n(null)}},Q=async(t,r)=>{if(window.confirm(`Are you sure you want to delete the report: "${r.substring(0,50)}..."? This action cannot be undone.`)){n(t);try{await S(t),A(s=>s.filter(m=>m.id!==t))}catch{alert("Failed to delete report.")}finally{n(null)}}},X=async(t,r)=>{if(window.confirm(`Are you sure you want to delete user "${r}"? This will only remove their data record.`)){n(t);try{await f(t),g(s=>s.filter(m=>m.uid!==t))}catch(s){alert(`Error deleting user: ${s.message}`)}finally{n(null)}}},Z=async(t,r)=>{if(window.confirm(`Are you sure you want to delete the task record for: "${r}"? This action cannot be undone.`)){n(t);try{await c(t),U(s=>s.filter(m=>m.id!==t))}catch{alert("Failed to delete task record.")}finally{n(null)}}},z=a.useMemo(()=>x.filter(t=>t.username.toLowerCase().includes(i.toLowerCase())),[x,i]),H=a.useMemo(()=>F.filter(t=>t.description.toLowerCase().includes(i.toLowerCase())||t.email.toLowerCase().includes(i.toLowerCase())),[F,i]),W=a.useMemo(()=>D.filter(t=>t.username.toLowerCase().includes(i.toLowerCase())||t.toolTitle.toLowerCase().includes(i.toLowerCase())||t.outputFilename.toLowerCase().includes(i.toLowerCase())),[D,i]),k=a.useMemo(()=>{const r=new Date().getTime()-1440*60*1e3;return{totalUsers:x.length,premiumUsers:x.filter(s=>s.isPremium).length,tasksToday:D.filter(s=>s.timestamp&&s.timestamp.toDate().getTime()>r).length,newReports:F.filter(s=>s.status==="New").length}},[x,F,D]),O=C||M||B;return e.jsx("div",{className:"py-16 md:py-24",children:e.jsx("div",{className:"px-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-gray-800 dark:text-gray-100",children:"Admin Dashboard"}),e.jsx("p",{className:"mt-2 text-gray-500 dark:text-gray-400",children:"Manage users and monitor site activity."})]}),e.jsx("button",{onClick:y,className:"bg-red-500 text-white font-bold py-2 px-4 rounded-md hover:bg-red-600 transition-colors self-start sm:self-center",children:"Logout"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md flex items-center gap-4 border-l-4 border-blue-500",children:[e.jsx(te,{className:"h-10 w-10 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:k.totalUsers})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md flex items-center gap-4 border-l-4 border-yellow-500",children:[e.jsx(se,{className:"h-10 w-10 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Premium Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:k.premiumUsers})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md flex items-center gap-4 border-l-4 border-purple-500",children:[e.jsx(ae,{className:"h-10 w-10 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Tasks Today"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:k.tasksToday})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md flex items-center gap-4 border-l-4 border-orange-500",children:[e.jsx(re,{className:"h-10 w-10 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"New Reports"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:k.newReports})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8 overflow-x-auto",children:[e.jsx("button",{onClick:()=>{L("users"),w("")},className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${o==="users"?"border-brand-red text-brand-red":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"User Management"}),e.jsxs("button",{onClick:()=>{L("reports"),w("")},className:`relative py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${o==="reports"?"border-brand-red text-brand-red":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Problem Reports",k.newReports>0&&e.jsx("span",{className:"absolute -top-1 -right-4 bg-brand-red text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:k.newReports})]}),e.jsx("button",{onClick:()=>{L("tasks"),w("")},className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${o==="tasks"?"border-brand-red text-brand-red":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Task History"}),e.jsx("button",{onClick:()=>{L("notifications"),w("")},className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${o==="notifications"?"border-brand-red text-brand-red":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Notifications"})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl overflow-hidden animated-border",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row gap-4 items-center",children:[e.jsx("input",{type:"text",placeholder:`Search by ${o==="users"?"username":o==="reports"?"email or description":o==="tasks"?"user, tool, or filename":"..."}...`,value:i,onChange:t=>w(t.target.value),className:"w-full sm:w-auto flex-grow px-4 py-2 bg-gray-100 dark:bg-gray-800 border border-transparent rounded-md focus:ring-brand-red focus:border-brand-red text-gray-800 dark:text-gray-200",disabled:o==="notifications"}),e.jsxs("button",{onClick:G,disabled:O,className:"flex items-center gap-2 text-sm font-semibold bg-gray-200 dark:bg-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(le,{className:`h-4 w-4 ${O?"animate-spin":""}`})," Refresh"]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[o==="users"&&e.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Username"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Premium Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"API Plan"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Joined Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:C?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6",children:"Loading users..."})}):l?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6 text-red-500",children:l})}):z.length>0?z.map(t=>e.jsxs("tr",{className:`border-b dark:border-gray-700 transition-colors ${t.isPremium?"bg-yellow-50 dark:bg-yellow-900/10":"bg-white dark:bg-gray-900"} hover:bg-gray-50 dark:hover:bg-gray-800/50`,children:[e.jsxs("th",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",children:[b===t.uid&&e.jsxs("svg",{className:"animate-spin h-4 w-4 inline mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),t.username]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>J(t.uid,t.isPremium),disabled:b===t.uid,className:`px-3 py-1 text-xs font-semibold rounded-full transition-colors ${t.isPremium?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300"}`,children:t.isPremium?"Active":"Activate"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:t.apiPlan||"free",disabled:b===t.uid,onChange:r=>K(t.uid,r.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-1.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"developer",children:"Developer"}),e.jsx("option",{value:"business",children:"Business"})]})}),e.jsx("td",{className:"px-6 py-4",children:t.creationDate?new Date(t.creationDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>X(t.uid,t.username),disabled:b===t.uid,title:"Delete User",className:"p-2 text-gray-400 hover:text-red-500 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors",children:e.jsx($,{className:"h-5 w-5"})})})]},t.uid)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6",children:"No users found."})})})]}),o==="reports"&&e.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"User"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Description"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-6",children:"Loading reports..."})}):I?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-6 text-red-500",children:I})}):H.length>0?H.map(t=>e.jsxs("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 dark:text-white",children:t.userName||t.email}),e.jsxs("td",{className:"px-6 py-4 text-xs max-w-sm",children:[e.jsx("p",{className:"truncate",title:t.description,children:t.description}),e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Page"})]}),e.jsx("td",{className:"px-6 py-4 font-semibold",children:t.problemType}),e.jsx("td",{className:"px-6 py-4",children:t.timestamp?new Date(t.timestamp.toDate()).toLocaleString():"N/A"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:t.status,disabled:b===t.id,onChange:r=>Y(t.id,r.target.value),className:`text-xs rounded-lg p-1.5 border ${t.status==="New"?"bg-orange-100 border-orange-300 text-orange-800":t.status==="In Progress"?"bg-blue-100 border-blue-300 text-blue-800":"bg-green-100 border-green-300 text-green-800"}`,children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Resolved",children:"Resolved"})]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>Q(t.id,t.description),disabled:b===t.id,title:"Delete Report",className:"p-2 text-gray-400 hover:text-red-500 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors",children:e.jsx($,{className:"h-5 w-5"})})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-6",children:"No reports found."})})})]}),o==="tasks"&&e.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"User"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Tool"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"File"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:B?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6",children:"Loading task history..."})}):E?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6 text-red-500",children:E})}):W.length>0?W.map(t=>e.jsxs("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 dark:text-white",children:t.username}),e.jsx("td",{className:"px-6 py-4 font-semibold",children:t.toolTitle}),e.jsxs("td",{className:"px-6 py-4 text-xs",children:[e.jsx("p",{className:"font-semibold truncate",title:t.outputFilename,children:t.outputFilename}),e.jsx("p",{className:"text-gray-400",children:ce(t.fileSize)})]}),e.jsx("td",{className:"px-6 py-4",children:t.timestamp?t.timestamp.toDate().toLocaleString():"N/A"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>Z(t.id,t.outputFilename),disabled:b===t.id,title:"Delete Task Record",className:"p-2 text-gray-400 hover:text-red-500 rounded-full disabled:opacity-50",children:e.jsx($,{className:"h-5 w-5"})})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6",children:"No tasks found."})})})]}),o==="notifications"&&e.jsx("div",{className:"p-4",children:e.jsx(xe,{})})]})]})]})})})};export{pe as default};
