import{u as H,r as a,j as e,Z as J,S as V,aq as Z,ar as _,g as G,y as R}from"./main-CxF7GYZy.js";import"./react-Ckhrjn13.js";const Q=()=>{const{getAllUsers:C,updateUserPremiumStatus:D,updateUserApiPlan:L,logout:$,deleteUser:T,getProblemReports:I,updateReportStatus:E,deleteProblemReport:F}=H(),[n,m]=a.useState([]),[h,j]=a.useState(!0),[f,N]=a.useState(""),[o,p]=a.useState(""),[c,l]=a.useState(null),[g,b]=a.useState([]),[u,w]=a.useState(!0),[v,k]=a.useState(""),[d,P]=a.useState("users"),y=async()=>{j(!0),N("");try{const s=await C();m(s)}catch{N("Failed to load user data.")}finally{j(!1)}},S=async()=>{w(!0),k("");try{const s=await I();b(s)}catch{k("Failed to load problem reports.")}finally{w(!1)}};a.useEffect(()=>{d==="users"?y():d==="reports"&&S()},[d]);const M=async(s,r)=>{l(s);try{await D(s,!r),m(n.map(t=>t.uid===s?{...t,isPremium:!r}:t))}catch{alert(`Failed to update status for user ${s}.`)}finally{l(null)}},z=async(s,r)=>{l(s);try{await L(s,r),m(n.map(t=>t.uid===s?{...t,apiPlan:r}:t))}catch{alert(`Failed to update API plan for user ${s}.`)}finally{l(null)}},B=async(s,r)=>{l(s);try{await E(s,r),b(t=>t.map(x=>x.id===s?{...x,status:r}:x))}catch{alert("Failed to update report status.")}finally{l(null)}},W=async(s,r)=>{if(window.confirm(`Are you sure you want to delete the report: "${r.substring(0,50)}..."? This action cannot be undone.`)){l(s);try{await F(s),b(t=>t.filter(x=>x.id!==s))}catch{alert("Failed to delete report.")}finally{l(null)}}},q=async(s,r)=>{if(window.confirm(`Are you sure you want to delete user "${r}"? This will only remove their data record.`)){l(s);try{await T(s),await y()}catch(t){alert(`Error deleting user: ${t.message}`)}finally{l(null)}}},U=a.useMemo(()=>n.filter(s=>s.username.toLowerCase().includes(o.toLowerCase())),[n,o]),A=a.useMemo(()=>g.filter(s=>s.description.toLowerCase().includes(o.toLowerCase())||s.email.toLowerCase().includes(o.toLowerCase())),[g,o]),i=a.useMemo(()=>({totalUsers:n.length,premiumUsers:n.filter(s=>s.isPremium).length,apiUsers:n.filter(s=>s.apiPlan&&s.apiPlan!=="free").length,newReports:g.filter(s=>s.status==="New").length}),[n,g]);return e.jsx("div",{className:"py-16 md:py-24",children:e.jsx("div",{className:"px-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-gray-800 dark:text-gray-100",children:"Admin Dashboard"}),e.jsx("p",{className:"mt-2 text-gray-500 dark:text-gray-400",children:"Manage users and monitor site activity."})]}),e.jsx("button",{onClick:$,className:"bg-red-500 text-white font-bold py-2 px-4 rounded-md hover:bg-red-600 transition-colors self-start sm:self-center",children:"Logout"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md flex items-center gap-4 border-l-4 border-blue-500",children:[e.jsx(J,{className:"h-10 w-10 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:i.totalUsers})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md flex items-center gap-4 border-l-4 border-yellow-500",children:[e.jsx(V,{className:"h-10 w-10 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Premium Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:i.premiumUsers})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md flex items-center gap-4 border-l-4 border-purple-500",children:[e.jsx(Z,{className:"h-10 w-10 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active API Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:i.apiUsers})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-md flex items-center gap-4 border-l-4 border-orange-500",children:[e.jsx(_,{className:"h-10 w-10 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"New Reports"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:i.newReports})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>{P("users"),p("")},className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="users"?"border-brand-red text-brand-red":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"User Management"}),e.jsxs("button",{onClick:()=>{P("reports"),p("")},className:`relative py-4 px-1 border-b-2 font-medium text-sm ${d==="reports"?"border-brand-red text-brand-red":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Problem Reports",i.newReports>0&&e.jsx("span",{className:"absolute -top-1 -right-4 bg-brand-red text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:i.newReports})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl overflow-hidden animated-border",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row gap-4 items-center",children:[e.jsx("input",{type:"text",placeholder:`Search by ${d==="users"?"username":"email or description"}...`,value:o,onChange:s=>p(s.target.value),className:"w-full sm:w-auto flex-grow px-4 py-2 bg-gray-100 dark:bg-gray-800 border border-transparent rounded-md focus:ring-brand-red focus:border-brand-red text-gray-800 dark:text-gray-200"}),e.jsxs("button",{onClick:d==="users"?y:S,disabled:h||u,className:"flex items-center gap-2 text-sm font-semibold bg-gray-200 dark:bg-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(G,{className:`h-4 w-4 ${h||u?"animate-spin":""}`})," Refresh"]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[d==="users"&&e.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Username"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Premium Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"API Plan"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Joined Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6",children:"Loading users..."})}):f?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6 text-red-500",children:f})}):U.length>0?U.map(s=>e.jsxs("tr",{className:`border-b dark:border-gray-700 transition-colors ${s.isPremium?"bg-yellow-50 dark:bg-yellow-900/10":"bg-white dark:bg-gray-900"} hover:bg-gray-50 dark:hover:bg-gray-800/50`,children:[e.jsxs("th",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",children:[c===s.uid&&e.jsxs("svg",{className:"animate-spin h-4 w-4 inline mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.username]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>M(s.uid,s.isPremium),disabled:c===s.uid,className:`px-3 py-1 text-xs font-semibold rounded-full transition-colors ${s.isPremium?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300"}`,children:s.isPremium?"Active":"Activate"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:s.apiPlan||"free",disabled:c===s.uid,onChange:r=>z(s.uid,r.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-1.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"developer",children:"Developer"}),e.jsx("option",{value:"business",children:"Business"})]})}),e.jsx("td",{className:"px-6 py-4",children:s.creationDate?new Date(s.creationDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>q(s.uid,s.username),disabled:c===s.uid,title:"Delete User",className:"p-2 text-gray-400 hover:text-red-500 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors",children:e.jsx(R,{className:"h-5 w-5"})})})]},s.uid)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-6",children:"No users found."})})})]}),d==="reports"&&e.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"User"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Description"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-6",children:"Loading reports..."})}):v?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-6 text-red-500",children:v})}):A.length>0?A.map(s=>e.jsxs("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 dark:text-white",children:s.userName||s.email}),e.jsxs("td",{className:"px-6 py-4 text-xs max-w-sm",children:[e.jsx("p",{className:"truncate",title:s.description,children:s.description}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Page"})]}),e.jsx("td",{className:"px-6 py-4 font-semibold",children:s.problemType}),e.jsx("td",{className:"px-6 py-4",children:s.timestamp?new Date(s.timestamp.toDate()).toLocaleString():"N/A"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:s.status,disabled:c===s.id,onChange:r=>B(s.id,r.target.value),className:`text-xs rounded-lg p-1.5 border ${s.status==="New"?"bg-orange-100 border-orange-300 text-orange-800":s.status==="In Progress"?"bg-blue-100 border-blue-300 text-blue-800":"bg-green-100 border-green-300 text-green-800"}`,children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Resolved",children:"Resolved"})]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>W(s.id,s.description),disabled:c===s.id,title:"Delete Report",className:"p-2 text-gray-400 hover:text-red-500 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors",children:e.jsx(R,{className:"h-5 w-5"})})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-6",children:"No reports found."})})})]})]})]})]})})})};export{Q as default};
