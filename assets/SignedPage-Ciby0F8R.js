import{a as C,r as n,j as e,B as F,aG as L,aH as T,y as O}from"./main-DYed1JvU.js";import{E as A}from"./jspdf.es.min-CJ-Fc8TB.js";import{u as E}from"./useSignedDocuments-s-rP7rk5.js";import"./react-Ckhrjn13.js";import"./useLastTasks-DKfHDkek.js";const I=({doc:a,onClose:o})=>{if(!a)return null;let m=[];try{m=JSON.parse(a.auditTrail)}catch(l){console.error("Could not parse audit trail",l)}return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:o,children:e.jsxs("div",{className:"bg-white dark:bg-black w-full max-w-2xl rounded-lg shadow-xl",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Document Details"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-gray-800 dark:text-gray-100",children:"File Information"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Original File:"})," ",a.originalFileName]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Signed File:"})," ",a.signedFileName]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:"text-green-600 font-semibold",children:a.status})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Created At:"})," ",new Date(a.createdAt).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-gray-800 dark:text-gray-100",children:"Signers"}),a.signers.map((l,g)=>e.jsxs("div",{className:"text-sm border-t pt-2 mt-2 first:border-t-0",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",l.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Signed At:"})," ",new Date(l.signedAt).toLocaleString()]})]},g))]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-gray-800 dark:text-gray-100",children:"Audit Trail"}),e.jsx("pre",{className:"text-xs bg-gray-100 dark:bg-gray-800 p-2 rounded-md whitespace-pre-wrap",children:JSON.stringify(m,null,2)})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-b-lg text-right",children:e.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold border rounded-md bg-white dark:bg-gray-700 hover:bg-gray-100",children:"Close"})})]})})},z=({className:a})=>e.jsx("div",{className:`p-2 bg-blue-600 rounded-md inline-block ${a}`,children:e.jsx("svg",{className:"h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})})}),M=()=>{const a=C(),{documents:o,loading:m,deleteSignedDocument:l}=E(),[g,c]=n.useState(null),[p,y]=n.useState(!1),h=n.useRef(null),[N,b]=n.useState(null),[x,v]=n.useState(""),w={startDate:"",endDate:"",statuses:{signed:!0,voided:!1,declined:!1,expired:!1,deleted:!1}},[d,j]=n.useState(w);n.useEffect(()=>{const t=s=>{h.current&&!h.current.contains(s.target)&&c(null)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const k=()=>{a("/sign-pdf")},D=(t,s)=>{const i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)},S=t=>{const s=new A;s.setFontSize(22),s.setFont("helvetica","bold"),s.text("INVOICE",14,22),s.setFontSize(10),s.text("PDFBullet",14,30),s.text("Kathmandu, Nepal",14,35),s.text("Support@pdfbullet.com",14,40),s.setFont("helvetica","normal"),s.text(`Invoice #: ${t.id}`,148,22),s.text(`Invoice Date: ${new Date(t.createdAt).toLocaleDateString()}`,148,28),s.text(`Due Date: ${new Date(t.createdAt).toLocaleDateString()}`,148,34),s.setFont("helvetica","bold"),s.text("Bill To:",14,55),s.setFont("helvetica","normal"),s.text(t.originator,14,61),s.setFontSize(14),s.setFont("helvetica","bold"),s.text("Audit Trail:",14,80),s.setFontSize(10);let i="No audit trail available.";try{i=JSON.stringify(JSON.parse(t.auditTrail),null,2)}catch(u){console.error("Error parsing audit trail:",u)}const r=s.splitTextToSize(i,180);s.text(r,14,86),s.save(`audit_trail_${t.id}.pdf`)},f=n.useMemo(()=>o.filter(t=>{const s=new Date(t.createdAt),i=x===""||t.signedFileName.toLowerCase().includes(x.toLowerCase())||t.originator.toLowerCase().includes(x.toLowerCase()),r=!d.startDate||s>=new Date(d.startDate),u=!d.endDate||s<=new Date(d.endDate);return i&&r&&u}),[o,x,d]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full bg-white dark:bg-surface-dark rounded-lg shadow-lg border border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-7 w-auto"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Signature"})]})]}),e.jsx("button",{onClick:k,className:"w-full sm:w-auto bg-brand-red hover:bg-brand-red-dark text-white font-bold py-2 px-6 rounded-md transition-colors",children:"New signature"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4",children:"Signed documents"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx("input",{type:"text",placeholder:"Search document",value:x,onChange:t=>v(t.target.value),className:"w-full pl-4 pr-10 py-2 border rounded-md"}),e.jsx(L,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"})]}),e.jsxs("button",{onClick:()=>y(!p),className:"flex items-center gap-2 py-2 px-4 border rounded-md text-sm font-semibold",children:["Filter ",e.jsx(T,{className:"h-4 w-4"})]})]}),p&&e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg mb-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"From"}),e.jsx("input",{type:"date",value:d.startDate,onChange:t=>j(s=>({...s,startDate:t.target.value})),className:"w-full mt-1 p-2 border rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"To"}),e.jsx("input",{type:"date",value:d.endDate,onChange:t=>j(s=>({...s,endDate:t.target.value})),className:"w-full mt-1 p-2 border rounded-md text-sm"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"File name"}),e.jsx("th",{className:"px-4 py-3",children:"Last modification"}),e.jsx("th",{className:"px-4 py-3",children:"Signers"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8",children:"Loading documents..."})}):f.length>0?f.map(t=>e.jsxs("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-800 dark:text-gray-100",children:t.signedFileName}),e.jsx("td",{className:"px-4 py-3",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3",children:t.signers.map(s=>s.name).join(", ")}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-xs font-bold text-green-600 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded-full",children:t.status.toUpperCase()})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"relative inline-block",ref:h,children:[e.jsx("button",{onClick:()=>c(g===t.id?null:t.id),className:"p-2 text-gray-500 rounded-full hover:bg-gray-200",children:"..."}),g===t.id&&e.jsxs("div",{className:"absolute top-full right-0 w-48 bg-white dark:bg-gray-800 border rounded-md shadow-lg z-10 text-left",children:[e.jsx("button",{onClick:()=>{D(t.signedFile,t.signedFileName),c(null)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Download signed file"}),e.jsx("button",{onClick:()=>{S(t),c(null)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Download audit trail"}),e.jsx("button",{onClick:()=>{b(t),c(null)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Details"}),e.jsx("div",{className:"border-t my-1"}),e.jsxs("button",{onClick:()=>{confirm("Delete permanently?")&&l(t.id),c(null)},className:"w-full text-left flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",children:[e.jsx(O,{className:"h-4 w-4"})," Delete"]})]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8",children:"No signed documents found."})})})]})})]})]}),e.jsx(I,{doc:N,onClose:()=>b(null)})]})};export{M as default};
